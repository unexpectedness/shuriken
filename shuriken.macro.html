<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>shuriken.macro documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Shuriken</span> <span class="project-version">0.14.52</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clojure</span></div></div></li><li class="depth-2"><a href="clojure.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>shuriken</span></div></div></li><li class="depth-2 branch"><a href="shuriken.associative.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>associative</span></div></a></li><li class="depth-2"><a href="shuriken.byte-buddy.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>byte-buddy</span></div></a></li><li class="depth-3"><a href="shuriken.byte-buddy.dsl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dsl</span></div></a></li><li class="depth-2 branch"><a href="shuriken.core.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="shuriken.debug.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debug</span></div></a></li><li class="depth-2 branch"><a href="shuriken.dev.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dev</span></div></a></li><li class="depth-2 branch"><a href="shuriken.exception.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>exception</span></div></a></li><li class="depth-2 branch"><a href="shuriken.iterator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>iterator</span></div></a></li><li class="depth-2 branch"><a href="shuriken.lazy.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lazy</span></div></a></li><li class="depth-2 branch"><a href="shuriken.let.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>let</span></div></a></li><li class="depth-2 branch current"><a href="shuriken.macro.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macro</span></div></a></li><li class="depth-2 branch"><a href="shuriken.meta.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>meta</span></div></a></li><li class="depth-2 branch"><a href="shuriken.monkey-patch.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>monkey-patch</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>monkey-patches</span></div></div></li><li class="depth-3 branch"><a href="shuriken.monkey-patches.as-macro.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>as-macro</span></div></a></li><li class="depth-3 branch"><a href="shuriken.monkey-patches.fn-source.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fn-source</span></div></a></li><li class="depth-3 branch"><a href="shuriken.monkey-patches.function-name.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>function-name</span></div></a></li><li class="depth-3"><a href="shuriken.monkey-patches.syntax-quote.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>syntax-quote</span></div></a></li><li class="depth-2 branch"><a href="shuriken.namespace.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>namespace</span></div></a></li><li class="depth-2 branch"><a href="shuriken.reflection.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>reflection</span></div></a></li><li class="depth-2 branch"><a href="shuriken.sequential.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sequential</span></div></a></li><li class="depth-2 branch"><a href="shuriken.source.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>source</span></div></a></li><li class="depth-2 branch"><a href="shuriken.spec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></a></li><li class="depth-2 branch"><a href="shuriken.string.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>string</span></div></a></li><li class="depth-2"><a href="shuriken.tree.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tree</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="shuriken.macro.html#var-*macroexpansions-dir*"><div class="inner"><span>*macroexpansions-dir*</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-clean-code"><div class="inner"><span>clean-code</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-code-signature"><div class="inner"><span>code-signature</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-delete-expansion-file.21"><div class="inner"><span>delete-expansion-file!</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-dump-code"><div class="inner"><span>dump-code</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-eval-file-delete"><div class="inner"><span>eval-file-delete</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-file-eval"><div class="inner"><span>file-eval</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-file-eval-error"><div class="inner"><span>file-eval-error</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-file-for-code"><div class="inner"><span>file-for-code</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-fully-unwrap-form"><div class="inner"><span>fully-unwrap-form</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-is-form.3F"><div class="inner"><span>is-form?</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-macro.3F"><div class="inner"><span>macro?</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-macroexpand-all-code"><div class="inner"><span>macroexpand-all-code</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-macroexpand-depth"><div class="inner"><span>macroexpand-depth</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-macroexpand-do"><div class="inner"><span>macroexpand-do</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-macroexpand-n"><div class="inner"><span>macroexpand-n</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-macroexpand-some"><div class="inner"><span>macroexpand-some</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-reluctant-macroexpanding-dance"><div class="inner"><span>reluctant-macroexpanding-dance</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-reluctant-macroexpanding-dance*"><div class="inner"><span>reluctant-macroexpanding-dance*</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-unwrap-form"><div class="inner"><span>unwrap-form</span></div></a></li><li class="depth-1"><a href="shuriken.macro.html#var-wrap-form"><div class="inner"><span>wrap-form</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">shuriken.macro</h1><div class="doc"><div class="markdown"><h3><a href="#tools-for-building-macros" id="tools-for-building-macros"></a>Tools for building macros</h3>
</div></div><div class="public anchor" id="var-*macroexpansions-dir*"><h3>*macroexpansions-dir*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-clean-code"><h3>clean-code</h3><div class="usage"><code>(clean-code code)</code><code>(clean-code reference-ns code)</code></div><div class="doc"><div class="markdown"><p>Unqualifies any symbol in <code>code</code>, and fully-qualifies those with an aliased namespace.</p>
<pre><code class="language-clojure">(clean-code `(a (b c)))
=&gt; '(a (b c))

By default `reference-ns` is *ns*.
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-code-signature"><h3>code-signature</h3><div class="usage"><code>(code-signature line column file)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-delete-expansion-file.21"><h3>delete-expansion-file!</h3><div class="usage"><code>(delete-expansion-file! signature)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-dump-code"><h3>dump-code</h3><div class="usage"><code>(dump-code f code)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-eval-file-delete"><h3>eval-file-delete</h3><h4 class="type">macro</h4><div class="usage"><code>(eval-file-delete sign f)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-file-eval"><h3>file-eval</h3><h4 class="type">macro</h4><div class="usage"><code>(file-eval code &amp; {:keys [locals line column file surface-code]})</code></div><div class="doc"><div class="markdown"><p>Evaluates code in a temporary file via <code>load-file</code> in the local lexical context. Keeps the temporary file aside if an error is raised, deleting it on the next successful run. Avoids overwriting the file if it already exists, allowing for manual edits in quest of a diagnostic if anything goes wrong.</p>
<pre><code class="language-clojure">(let [a 1]
(file-eval '(+ 1 a)))
</code></pre>
<p>Code evaluated this way will be source-mapped in stacktraces.</p>
</div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-file-eval-error"><h3>file-eval-error</h3><div class="usage"><code>(file-eval-error f t)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-file-for-code"><h3>file-for-code</h3><div class="usage"><code>(file-for-code code line column file)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-fully-unwrap-form"><h3>fully-unwrap-form</h3><div class="usage"><code>(fully-unwrap-form sym code &amp; {:keys [count], :or {count false}})</code></div><div class="doc"><div class="markdown"><p>Recursively calls <a href="shuriken.macro.html#var-unwrap-form">unwrap-form</a> until the form is fully unwrapped.</p>
</div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-is-form.3F"><h3>is-form?</h3><div class="usage"><code>(is-form? sym code)</code></div><div class="doc"><div class="markdown"><p>Determines whether <code>code</code> is a form starting with <code>sym</code>.</p>
<pre><code class="language-clojure">(is-form? 'a 1)       ; =&gt; false
(is-form? 'a '[a :z]) ; =&gt; false
(is-form? 'a '(a :z)) ; =&gt; true
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-macro.3F"><h3>macro?</h3><div class="usage"><code>(macro? x)</code><code>(macro? reference-ns x)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-macroexpand-all-code"><h3>macroexpand-all-code</h3><div class="usage"><code>(macroexpand-all-code expr &amp; {:as opts})</code></div><div class="doc"><div class="markdown"><p>Like clojure.walk/macroexpand-all but does not expand quoted forms.</p>
<pre><code class="language-clojure">(defmacro m [] :abc)

(clojure.walk/macroexpand-all '((m) (quote (m))))
=&gt; (:abc (quote :abc))

(macroexpand-all-code '((m) (quote (m))))
=&gt; (:abc (quote (m)))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-macroexpand-depth"><h3>macroexpand-depth</h3><div class="usage"><code>(macroexpand-depth n expr)</code></div><div class="doc"><div class="markdown"><p>Expands the first <code>n</code> levels of <code>expr</code> with <a href="shuriken.macro.html#var-macroexpand-all-code">macroexpand-all-code</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-macroexpand-do"><h3>macroexpand-do</h3><h4 class="type">macro</h4><div class="usage"><code>(macroexpand-do &amp; args)</code></div><div class="doc"><div class="markdown"><p>(defmacro abc [] `(println “xyz”))</p>
<p>(macroexpand-do (abc))</p>
<p>; – Macro expansion – ; (clojure.core/println “xyz”) ; – Running macro – ; xyz</p>
<p>or alternatively:</p>
<p>(macroexpand-do MODE expr)</p>
<p>Where <code>MODE</code> has the following meaning:</p>
<table>
<thead>
<tr><th> <code>MODE</code>                        </th><th> expansion                        </th></tr>
</thead>
<tbody>
<tr><td> <code>nil</code> (the default)           </td><td> <code>macroexpand</code>                    </td></tr>
<tr><td> <code>:all</code>                        </td><td> <code>macroexpand-all-code</code>           </td></tr>
<tr><td> :n  <number>                  </number></td><td> <code>macroexpand-n</code>                  </td></tr>
<tr><td> :depth <number>               </number></td><td> <code>macroexpand-depth</code>              </td></tr>
<tr><td> :some <fn>                    </fn></td><td> <code>macroexpand-some</code>               </td></tr>
</tbody>
</table>
</div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-macroexpand-n"><h3>macroexpand-n</h3><div class="usage"><code>(macroexpand-n n form)</code></div><div class="doc"><div class="markdown"><p>Iteratively call <code>macroexpand-1</code> on <code>form</code> <code>n</code> times.</p>
</div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-macroexpand-some"><h3>macroexpand-some</h3><div class="usage"><code>(macroexpand-some pred expr &amp; {:as opts})</code></div><div class="doc"><div class="markdown"><p>Recursively macroexpands seqs in <code>expr</code> whose first element matches <code>pred</code>. Symbols are passed to <code>filter</code>, their namespace stripped. Quoted forms are not expanded.</p>
<pre><code class="language-clojure">(macroexpand-some #{'let}
  '(let [a (let [aa 1] aa)
         b '(let [bb 2] bb)]
     (dosync [a b])))
=&gt; (let* [a (let* [aa 1] aa)  ; expanded
          b '(let [bb 2] bb)] ; not expanded since quoted
     (dosync nil))            ; not expanded b/c pred does not match
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-reluctant-macroexpanding-dance"><h3>reluctant-macroexpanding-dance</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-reluctant-macroexpanding-dance*"><h3>reluctant-macroexpanding-dance*</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>See <a href="shuriken.macro.html#var-reluctant-macroexpanding-dance">reluctant-macroexpanding-dance</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-unwrap-form"><h3>unwrap-form</h3><div class="usage"><code>(unwrap-form sym code)</code></div><div class="doc"><div class="markdown"><p>Unwraps <code>code</code> if it is a form starting with <code>sym</code>. Returns <code>code</code> otherwise.</p>
<pre><code class="language-clojure">(unwrap-form 'a '(a :z))                        ; a
(-&gt;&gt; '(a :z) (unwrap-form 'a) (unwrap-form 'a)) ; a
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div><div class="public anchor" id="var-wrap-form"><h3>wrap-form</h3><div class="usage"><code>(wrap-form sym code)</code></div><div class="doc"><div class="markdown"><p>Wraps <code>code</code> in a form begining with <code>sym</code> unless it is already the case.</p>
<pre><code class="language-clojure">(wrap-form 'a :z)                      ; =&gt; (a :z)
(-&gt;&gt; :z (wrap-form 'a) (wrap-form 'a)) ; =&gt; (a :z)
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/unexpectedness/shuriken/">view source</a></div></div></div></body></html>